<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNN-Δ₀ • Thermodynamic Native Network • Criticality Engine</title>
    <meta name="description" content="4D Rastrigin Optimization Simulation utilizing Thermodynamic Native Agents (TNA) and Criticality Analysis.">

    <!--
        THERMODYNAMIC NATIVE NETWORK (TNN) - EXTROPIC EDITION
        -----------------------------------------------------
        Architecture: Polymathic Synthesis (Biophysics + Glaciology + Thermodynamics)
        Core Logic: Langevin Dynamics on 4D Hyper-Surface
        Objective: Detect 'Edge of Chaos' Criticality via Power-Law Exponents (Alpha)

        Theory References:
        1. Extropic AI: Thermodynamic Sampling Units (TSU)
        2. Manus AI Report (Nov 2025): Negative Alpha Plateaus in High-Entropy Regimes
        3. Glaciology Metaphor: Basal Sliding (Plateau) vs. Bedrock Carving (Convergence)
    -->

    <!-- Module Imports via Import Map for Stability -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/"
            }
        }
    </script>

    <!-- Tailwind & Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Deep Space UI Theme */
        body { margin: 0; overflow: hidden; background: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; }

        #canvas-container {
            width: 100vw; height: 65vh; position: relative;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
        }

        #dashboard {
            height: 35vh; display: grid; grid-template-columns: 400px 1fr 1fr; gap: 1rem; padding: 1rem;
            background: #020617; border-top: 1px solid #312e81;
            box-shadow: 0 -10px 20px rgba(0,0,0,0.5);
        }

        .panel {
            background: rgba(15, 23, 42, 0.8);
            padding: 1rem; border-radius: 0.75rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            display: flex; flex-direction: column;
        }

        h2 {
            font-size: 0.9rem; font-weight: 800; letter-spacing: 0.1em; text-transform: uppercase;
            color: #818cf8; margin-bottom: 1rem; display: flex; justify-content: space-between;
        }

        .val { font-family: 'JetBrains Mono', monospace; color: #38bdf8; }

        /* Interactive Elements */
        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%;
            background: #c084fc; cursor: pointer; margin-top: -5px;
            box-shadow: 0 0 10px #c084fc;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px;
        }

        button {
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        button:active { transform: translateY(0); }

        /* Status Indicators */
        .status-plateau { color: #f87171; text-shadow: 0 0 8px rgba(248, 113, 113, 0.4); }
        .status-converge { color: #4ade80; text-shadow: 0 0 8px rgba(74, 222, 128, 0.4); }
        .status-critical { color: #f0abfc; text-shadow: 0 0 12px rgba(240, 171, 252, 0.6); animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body>

<div id="canvas-container">
    <!-- Overlay UI -->
    <div class="absolute top-4 left-4 z-10 pointer-events-none">
        <div class="text-xs font-bold text-indigo-400 tracking-widest">TNN-Δ₀ SYSTEM</div>
        <div class="text-[10px] text-gray-500 font-mono mt-1">TSU EMULATION: ACTIVE</div>
        <div class="text-[10px] text-gray-500 font-mono">TOPOLOGY: 4D RASTRIGIN</div>
    </div>
    <div id="vr-button" class="absolute bottom-4 right-4 z-10"></div>
</div>

<div id="dashboard">
    <!-- CONTROLS -->
    <div class="panel overflow-y-auto">
        <h2>
            <span>Control Deck</span>
            <span class="text-[10px] bg-indigo-900/50 px-2 py-1 rounded text-indigo-300">v3.0.2 (FIXED)</span>
        </h2>

        <div class="space-y-5">
            <!-- Temp Slider -->
            <div>
                <div class="flex justify-between text-xs mb-1">
                    <span class="text-gray-400">Thermodynamic Noise (T)</span>
                    <span id="temp-val" class="val">20.0</span>
                </div>
                <input type="range" id="temp-slider" min="0.1" max="150" step="0.1" value="20">
                <div class="flex justify-between text-[9px] text-gray-600 uppercase font-bold tracking-wider">
                    <span>Crystalline (Low T)</span>
                    <span>Plasma (High T)</span>
                </div>
            </div>

            <!-- Agent Slider -->
            <div>
                <div class="flex justify-between text-xs mb-1">
                    <span class="text-gray-400">Swarm Population</span>
                    <span id="batch-val" class="val">1000</span>
                </div>
                <input type="range" id="batch-slider" min="100" max="5000" step="100" value="1000">
            </div>

            <!-- Modes -->
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="block text-[9px] text-gray-500 uppercase mb-1">Annealing Schedule</label>
                    <select id="anneal-select" class="w-full bg-slate-900 border border-slate-700 text-xs text-gray-300 rounded p-1 outline-none focus:border-indigo-500">
                        <option value="logarithmic" selected>Logarithmic (Optimal)</option>
                        <option value="glacial">Glacial Cycle (Oscillating)</option>
                        <option value="none">Isothermal (Constant T)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-[9px] text-gray-500 uppercase mb-1">Physics Engine</label>
                    <select id="method-select" class="w-full bg-slate-900 border border-slate-700 text-xs text-gray-300 rounded p-1 outline-none focus:border-indigo-500">
                        <option value="langevin">Langevin (Analog TSU)</option>
                        <option value="noisy_gd">Noisy GD (Digital)</option>
                    </select>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2 pt-2">
                <button onclick="startSimulation()" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded shadow-lg shadow-indigo-900/20">Ignite Swarm</button>
                <button onclick="resetSimulation()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded">Reset</button>
                <button onclick="exportState()" class="px-3 bg-slate-800 hover:bg-slate-700 text-indigo-400 rounded border border-slate-600" title="Export Data">⇩</button>
            </div>

            <div class="flex justify-between items-center border-t border-slate-800 pt-2 text-[10px] font-mono">
                <span class="text-gray-500">STATUS: <span id="sim-status" class="text-yellow-500">STANDBY</span></span>
                <span class="text-gray-500">STEP: <span id="step-count" class="text-white">0</span></span>
            </div>
        </div>
    </div>

    <!-- DIAGNOSTICS -->
    <div class="panel">
        <h2>System Diagnostics</h2>

        <div class="grid grid-cols-2 gap-4 text-xs mb-4">
            <div class="bg-slate-900/50 p-2 rounded border border-slate-800">
                <div class="text-gray-500 mb-1">Mean Energy (Loss)</div>
                <div id="avg-energy" class="text-lg font-mono text-white">--</div>
            </div>
            <div class="bg-slate-900/50 p-2 rounded border border-slate-800">
                <div class="text-gray-500 mb-1">Global Min Detected</div>
                <div id="min-energy" class="text-lg font-mono text-emerald-400">--</div>
            </div>
        </div>

        <div class="mb-auto">
            <div class="flex justify-between items-center mb-1">
                <span class="text-xs text-gray-400">Convergence Alpha (α)</span>
                <span id="alpha-val" class="text-sm font-mono font-bold text-gray-200">--</span>
            </div>
            <!-- Alpha Meter -->
            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden relative">
                <div id="alpha-bar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 absolute transition-all duration-500" style="width: 0%; left: 50%"></div>
                <!-- Center Marker -->
                <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/20"></div>
            </div>
            <div class="flex justify-between text-[9px] text-gray-600 mt-1 font-mono">
                <span>PLATEAU (Neg)</span>
                <span>CONVERGENCE (Pos)</span>
            </div>
        </div>

        <div class="mt-3 p-3 bg-slate-900 rounded border border-indigo-900/30 shadow-inner">
            <div class="text-[10px] font-bold text-indigo-400 uppercase mb-1">Glaciology Analysis</div>
            <div id="analysis-text" class="text-xs text-gray-300 leading-relaxed">
                System awaiting thermal ignition. <br>
                <span class="text-gray-600">Target: Criticality Phase Transition.</span>
            </div>
        </div>
    </div>

    <!-- TELEMETRY -->
    <div class="panel">
        <canvas id="energyChart"></canvas>
    </div>
</div>

<!-- ENGINE CORE -->
<script type="module" src="/src/main.ts"></script>
</body>
</html>